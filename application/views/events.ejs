<h2 class="events-header">Campus Events</h2>
<% if (user && user.type == "admin") { %>
  <a href="#" onclick="newPost()"><span class="fa fa-pencil-square-o new-post"> New Post</span></a>
<% } %>
<div class="clearfix"></div>
<p class="page-description">What and where is going on!</p>

<% if (user && user.type == "admin") { %>
  <div id="createForm" class="col-xs-12 hidden">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">New Post</h3>
      </div>

      <div class="panel-body">
        <form action="/createPost" method="post" role="form">
          <div class="form-group">
            <label class="control-label" for="titleInput">Title</label>
            <input class="form-control" id="titleInput" name="title" placeholder="Post title">
          </div>
          <div class="form-group">
            <label class="control-label" for="textInput">Post Body</label>
            <textarea class="form-control" id="textInput" name="text" placeholder="Type your post..." rows="3"></textarea>
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-primary">Create Post</button>
            <a href="#" onclick="cancelPost()" class="cancel-post">Cancel</a>
          </div>
          <div class="form-group" id="alerts">
            <% if (message) { %>
            <div class='alert alert-danger' style='padding: 5px 10px; margin: 5px 0px'><%= message %></div>
            <% } %>
          </div>
        </form>
      </div>

    </div>
  </div>
<% } %>

<div id="news_feed" class="col-xs-12">
  <% for (var i = 0; i < posts.length; i++) { %>
    <div id="post-<%=posts[i].id%>" class="panel panel-default">
      <div class="panel-heading">
        <h3 id="title<%=posts[i].id%>" class="panel-title">
          <%=posts[i].title%>
        </h3>
      </div>

      <div id="text<%=posts[i].id%>" class="panel-body">
        <%=posts[i].text%>
      </div>

      <div class="panel-footer">
        <% var date = new Date(posts[i].created_at); %>
        Posted by <%=posts[i].author.name%> on <%=date.toDateString()%> at <%=date.toLocaleTimeString().slice(0, -3)%>.
        <% if (user && user.type == "admin") { %>
          <p><a onclick="editPost(<%=posts[i].id%>)">edit post</a> | 
          <a href="/deletePosts?ids=<%=posts[i].id%>">delete post</a></p>
        <% } %>
      </div>
    </div>
  <% } %>
</div>

<% if (user && user.type == "admin") { %>
  <div id="editForm" class="col-xs-12 hidden">
    <div class="panel panel-primary">
      <h2>Edit Post</h2>
      <br>
      <form action="/updatePost" method="post" role="form">
        <div class="form-group hidden">
          <label class="control-label" for="editId">Id</label>
          <input class="form-control" id="editId" name="id">
        </div>
        <div class="form-group">
          <label class="control-label" for="editTitleInput">Title</label>
          <input class="form-control" id="editTitleInput" name="title" placeholder="Post title">
        </div>
        <div class="form-group">
          <label class="control-label" for="editTextInput">Post Body</label>
          <textarea class="form-control" id="editTextInput" name="text" placeholder="Type your post..." rows="3"></textarea>
        </div>
        <div class="btn-group">
          <button type="submit" class="btn btn-primary">Update Post</button>
          <button type="button" id="cancelEdit" class="btn btn-default">Cancel</button>
        </div>
        <div class="form-group" id="alerts">
          <% if (message) { %>
            <div class='alert alert-danger' style='padding: 5px 10px; margin: 5px 0px'><%= message %></div>
          <% } %>
        </div>
      </form>
    </div>
  </div>
<% } %>

<script>
  var newPost = function() {
    $("#createForm").removeClass("hidden");
  };

  var cancelPost = function() {
    $("#createForm").addClass("hidden");
  };

  // fill form for edit
  var editPost = function(id) {
    $("#editId").attr("data-id", id);
    $("#editTitleInput").val($("#title" + id).text().trim());
    $("#editTextInput").val($("#text" + id).text().trim());
    $("#editForm").removeClass("hidden");
    $("#createForm").addClass("hidden");
    var postId = "#post-" + id;
    $(postId).addClass("hidden");
  }

  // cancel edit
  $("#cancelEdit").click(function(e) {
    var id = $("#editId").attr("data-id");
    $("#editId").val("");
    $("#editId").val("");
    $("#editTitleInput").val("");
    $("#editTextInput").val("");
    $("#editForm").addClass("hidden");
    var postId = "#post-" + id;
    $(postId).removeClass("hidden");
  });
</script>
