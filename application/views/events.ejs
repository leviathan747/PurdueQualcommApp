<% include navigation.ejs %>
<div id="container">
  <div id="page-events" class="page">
    <h2>Campus Events</h2>
    <p class="page-description">What and where is going on!</p>
    <div class="container-fluid">
      <div class="row">
        <div id="news_feed" class="col-xs-12">
          <a onclick="refreshPosts()">Refresh feed</a>
          <br>
        </div>
        <% if (user && user.type == "admin") { %>
        <div class="col-xs-12">
          <div class="panel panel-primary">
            <h2>Create Post</h2>
            <br>
            <form action="/createPost" method="post" role="form" id="postForm">
              <div class="form-group" id="titleGroup">
                <label class="control-label" for="titleInput">Title</label>
                <input class="form-control" id="titleInput" name="title" placeholder="Post title">
              </div>
              <div class="form-group" id="textGroup">
                <label class="control-label" for="textInput">Post Body</label>
                <textarea class="form-control" id="textInput" name="text" placeholder="Type your post..." rows="3"></textarea>
              </div>
              <div class="form-group">
                <button type="submit" class="btn btn-primary btn-block">Create Post</button>
              </div>
              <div class="form-group" id="alerts">
                <% if (message) { %>
                <div class='alert alert-danger' style='padding: 5px 10px; margin: 5px 0px'><%= message %></div>
                <% } %>
              </div>
            </form>
          </div>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<script>

function refreshPosts() {
  // empty old
  $("#news_feed .panel").remove();

  var posts;
  $.get("/getPosts", null, function(p) {
    posts = p;
    for (var i = 0; i < posts.length; i++) {
      var post = new EJS({url: "/templates/post.ejs"});
      $("#news_feed").append(post.render({
        author: posts[i].author,
        timestamp: posts[i].created_at,
        title: posts[i].title,
        text: posts[i].text
      }));
    }
  }, "json");
}

refreshPosts();

</script>
